{% extends "base.html" %}
{% load static %}

{% block title %}My Orders | Canteen{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/my_orders.css' %}">
{% endblock %}

{% block content %}


<!-- ğŸ”” TOAST MESSAGE -->
{% if messages %}
<div id="toast-overlay">
    <div class="toast">
        {% for message in messages %}
            {{ message }}
        {% endfor %}
    </div>
</div>
{% endif %}

<h1 class="page-title">ğŸ§¾ My Orders</h1>

<a href="{% url 'menu' %}" class="back-link">
    â¬… Back to Menu<br>
</br>
</a>

{% if orders %}
    {% for order in orders %}
        <div class="order-card">

            <!-- HEADER -->
            <div class="order-header">
                <span class="order-id">Order #{{ order.id }}</span>

                <span class="order-status
                    {% if order.status == 'pending' %}
                        status-pending
                    {% elif order.status == 'completed' %}
                        status-completed
                    {% else %}
                        status-cancelled
                    {% endif %}
                ">
                    {{ order.status|title }}
                </span>
            </div>

            <!-- TOKEN + ETA -->
            {% if order.status == "pending" %}
                <div class="order-time">
                    ğŸ« Token: <strong>{{ order.token_number }}</strong>
                </div>

                <div class="order-time">
                    â± Expected delivery:
                    <strong>{{ order.eta_minutes }} minutes</strong>
                </div>
            {% elif order.status == "completed" %}
                <div class="order-time">âœ… Delivered</div>
            {% else %}
                <div class="order-time">âŒ Cancelled</div>
            {% endif %}

            <!-- ORDER DATE -->
            <div class="order-time">
                Ordered on {{ order.created_at }}
            </div>

            <!-- ITEMS -->
            <ul class="order-items">
                {% for item in order.orderitem_set.all %}
                    <li>
                        <span class="item-name">{{ item.menu_item.Item_name }}</span>
                        <span class="item-qty">Ã— {{ item.quantity }}</span>
                        <span class="item-price">â‚¹ {{ item.menu_item.price }}</span>
                    </li>
                {% endfor %}
            </ul>

            <!-- âŒ CANCEL BUTTON -->
            {% if order.status == "pending" %}
                <form method="POST" action="{% url 'cancel_order' order.id %}">
                    {% csrf_token %}
                    <button type="submit" class="cancel-btn">
                        âŒ Cancel Order
                    </button>
                </form>
            {% endif %}

        </div>
    {% endfor %}
{% else %}
    <p class="empty-orders">You have not placed any orders yet.</p>
{% endif %}


{% endblock %}

{% block extra_js %}
<script>
    const toast = document.querySelector(".toast");
    if (toast) {
        setTimeout(() => {
            toast.parentElement.remove();
        }, 3000);
    }
</script>
{% endblock %}

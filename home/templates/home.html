{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Canteen Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
</head>

<body>

<header class="top-bar">
    <h1>Canteen Dashboard</h1>
    <p>Welcome {{ name }} ğŸ‘‹ to Canteen Queue System</p>
</header>

<main class="dashboard">

    <a href="{% url 'menu' %}" class="card">
        <h2>ğŸ½ï¸ Show Menu</h2>
        <p>View available food items</p>
    </a>

    <a href="{% url 'my_orders' %}" class="card">
        <h2>ğŸ§¾ Your Orders</h2>
        <p>View order history</p>
    </a>

 <!-- MY TOKEN -->
    <div class="card info">
        <h2>ğŸ« My Token</h2>
        <p class="big">
            {% if my_token %}
                {{ my_token }}
            {% else %}
                --
            {% endif %}
        </p>
    </div>


<div class="card info">
    <h2>â±ï¸ Expected Time</h2>

    {% if expected_seconds %}
        <p class="big" id="countdown"
           data-seconds="{{ expected_seconds }}">
            {{ expected_time }} mins
        </p>
    {% else %}
        <p class="big">--</p>
    {% endif %}
</div>

    <!-- RUNNING TOKEN -->
<div class="card highlight">
        <h2>ğŸ”„ Running Token</h2>
        <p class="big">
            {% if running_token %}
                {{ running_token }}
            {% else %}
                --
            {% endif %}
        </p>
    </div>

</main>

<script>
(function () {
    const el = document.getElementById("countdown");
    if (!el) return;

    let remaining = parseInt(el.dataset.seconds);
    if (isNaN(remaining) || remaining <= 0) return;

    function formatTime(sec) {
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
    }

    function tick() {
        if (remaining <= 0) {
            el.textContent = "Almost Ready ğŸ½ï¸";
            return;
        }
        el.textContent = formatTime(remaining);
        remaining--;
        setTimeout(tick, 1000);
    }

    tick();
})();
</script>

</body>
</html>
